
# this line is required
package dbup;


use PDBA;

use vars qw( 
	$dateFormat $ignoreFile
	%parms %uptime %addresses 
	%onCallList @supervisors
);


# format of date in ignoreFile
$dateFormat = "%Y/%m/%d-%H:%M:%S";
$ignoreFile = 'dbignore.conf';


%parms = (

	mailServer => 'mail.yourdomain.com',

	fromAddress => 'oracle@yourdomain.com',

	# how often to check database connectivity
	# measured in seconds
	# low value used for testing
	#connectInterval => 30,
	connectInterval => 300,

	# avoid hangs - timeout is in seconds
	connectionTimeOut => 60,

	# hours are 0 - 23
	# these are the hours to page immediately without
	# retrying the connection.  outside of these hours,
	# retry a configurable number of times before paging

	hoursToPageImmediate => [6..18],
	# use a limited range for testing during the day
	#hoursToPageImmediate => [19..20],
	# don't page DBA during lunch. :)
	#hoursToPageImmediate => [6..11, 13..18],

	# how many times to retry a connection when the time
	# is outside the range of hoursToPage
	maxConnectRetries => 3,

	# *everything* is logged
	# will use PDBA_HOME
	#logfile => qq{$ENV{PDBA_HOME}/logs/dbup.log},
	logfile => PDBA->pdbaHome() . q{/logs/dbup.log},

);

=head1 example uptime hash


%uptime = (

	# examples are from lowest priority to highest
	
	# database name
	8x5=> {
		
		# up mon-fri
		upDays => [1..5],

		# hours that database must be up
		# 8 a.m. - 4 p.m.
		# if the hour is outside this range, send email only
		# do not page
		upHours => [8..16],

		# username to connect as
		username => 'system',

		alertLevel => 1,

	},

	# database name
	12x5=> {

		# mon-fri
		upDays => [1..5],

		# 6 a.m. - 6 p.m.
		# if the hour is outside this range, send email only
		# do not page
		upHours => [6..18],

		# username to connect as
		username => 'system',

		alertLevel => 2,

	},


	# database name
	24x7=> {
		# days that the database must be up
		# 0-6 = sun-sat
		upDays => [0..6],

		# up 24 hrs
		# if the hour is outside this range, send email only
		# do not page until max retries on connect encountered
		upHours => [0..23],

		# username to connect as
		username => 'system',

		alertLevel => 3,

	},




);

=cut


%uptime = (

	ts01 => {
		machine => 'sherlock',
		upDays => [0..6],
		upHours => [0..23],
		username => 'system',
		alertLevel => 3,
	},

	ts20 => {
		machine => 'mycroft',
		upDays => [0..6],
		upHours => [0..23],
		username => 'system',
		alertLevel => 3,
	},

	ts99 => {
		machine => 'watson',
		upDays => [1..5],
		upHours => [6..18],
		username => 'system',
		alertLevel => 2,
	},

);

%addresses = (

	'dbamgr' => {
		pager => '7775551212@mobile.att.net',
		emailWork => 'atwork@yourdomain.com',
		emailHome => 'athome@yourdomain.com',
	},

	'opsmgr' => {
		pager => '7775551212@mobile.att.net',
		emailWork => 'atwork@yourdomain.com',
		emailHome => 'athome@yourdomain.com',
	},

	'dba_1' => {
		pager => '7775551212@mobile.att.net',
		emailWork => 'atwork@yourdomain.com',
		emailHome => 'athome@yourdomain.com',
	},

	'dba_2' => {
		pager => '7775551212@mobile.att.net',
		emailWork => 'atwork@yourdomain.com',
		emailHome => 'athome@yourdomain.com',
	}

);

# these need to be the names of standard address
# entries in the %addresses hash.
# if these exist, supervisors will be paged at
# all times a DBA is paged, and will be sent
# all mail sent to the oncall DBA
# if you don't want this feature to be enabled,
# set it to an empty list.
# e.g. 
#   @supervisors=();
# or just comment it out.
@supervisors = ('opsmgr','dbamgr');


%onCallList = (
	'20011003' => 'dba_1',
	'20011010' => 'dba_2',
	'20011017' => 'dba_1',
	'20011024' => 'dba_2',
	'20011031' => 'dba_1',
	'20011107' => 'dba_2',
	'20011114' => 'dba_1',
	'20011121' => 'dba_2',
	'20011128' => 'dba_1',
	'20011205' => 'dba_2',
	'20011212' => 'dba_1',
	'20011219' => 'dba_2',
	'20011226' => 'dba_1',
	'20020102' => 'dba_2',
	'20020109' => 'dba_1',
	'20020116' => 'dba_2',
	'20020123' => 'dba_1',
	'20020130' => 'dba_2',
	'20020206' => 'dba_1',
	'20020213' => 'dba_2',
	'20020220' => 'dba_1',
	'20020227' => 'dba_2',
	'20020306' => 'dba_1',
	'20020313' => 'dba_2',
	'20020320' => 'dba_1',
	'20020327' => 'dba_2',
	'20020403' => 'dba_1',
	'20020410' => 'dba_2',
	'20020417' => 'dba_1',
	'20020424' => 'dba_2',
	'20020501' => 'dba_1',
	'20020508' => 'dba_2',
	'20020515' => 'dba_1',
	'20020522' => 'dba_2',
	'20020529' => 'dba_1',
	'20020605' => 'dba_2',
	'20020612' => 'dba_1',
	'20020619' => 'dba_2',
	'20020626' => 'dba_1',
	'20020703' => 'dba_2',
	'20020710' => 'dba_1',
	'20020717' => 'dba_2',
	'20020724' => 'dba_1',
	'20020731' => 'dba_2',
	'20020807' => 'dba_1',
	'20020814' => 'dba_2',
	'20020821' => 'dba_1',
	'20020828' => 'dba_2',
	'20020904' => 'dba_1',
	'20020911' => 'dba_2',
	'20020918' => 'dba_1',
	'20020925' => 'dba_2',
	'20021002' => 'dba_1',
	'default' => 'dba_1',
);





